<!--

=========================================================
* Volt Free - Bootstrap 5 Dashboard
=========================================================

* Product Page: https://themesberg.com/product/admin-dashboard/volt-bootstrap-5-dashboard
* Copyright 2021 Themesberg (https://www.themesberg.com)
* License (https://themesberg.com/licensing)

* Designed and coded by https://themesberg.com

=========================================================

* The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software. Please contact us to request a removal.

-->

{% extends 'base.html' %}
{% import 'module/modals.html' as modals %}

{% block head %}
  {{ super() }}
  <!-- Datatables CSS -->
  <link rel="stylesheet" href="//cdn.datatables.net/1.12.0/css/jquery.dataTables.min.css">

  <!-- stonly-widget - copy into the head -->
  <script>window.STONLY_WID = "557476f0-4f0d-11ed-871a-0a52ff1ec764";</script>
  <script>
    !function (s, t, o, n, l, y, w, g) {
      s.StonlyWidget || ((w = s.StonlyWidget = function () {
        w._api ? w._api.apply(w, arguments) : w.queue.push(arguments)
      }).scriptPath = n, w.queue = [], (y = t.createElement(o)).async = !0,
        (g = new XMLHttpRequest).open("GET", n + "version?v=" + Date.now(), !0), g.onreadystatechange = function () {
          4 === g.readyState && (y.src = n + "stonly-widget.js?v=" + (200 === g.status ? g.responseText : Date.now()),
            (l = t.getElementsByTagName(o)[0]).parentNode.insertBefore(y, l))
        }, g.send())
    }(window, document, "script", "https://stonly.com/js/widget/v2/");
  </script>
{% endblock %}

{% block title %}
{{ super() }}
Cálculo
{% endblock %}

{% block content %}
{{ super() }}
<body onload ="ActivateLink('calc')">
  {% block sidebar %}
  {% include 'module/sidebar.html' %}
  {% endblock %}
  
  <main class="content">
  <div class="d-none d-lg-flex justify-content-end">
    {% block nav %}
    {% include 'module/navbar.html' %}
    {% endblock %}    
  </div>
  
    <section id="main">
      <div class="row mt-2">
        <div class="col-12 d-flex flex-column">
          <div class="card border-0 shadow components-section flex-grow-1 pt-3 px-2 px-md-4 px-xxl-5">
            <div class="card-body p-0">
              <div class="row mt-4 mt-lg-4">
                <div class="col-12 px-4 px-md-2">
                  <h3 class="fw-extrabold">Bienvenido al cálculo de indicadores</h2>
                  <p class="mb-0 justified-text">En este módulo se visualiza la tendencia histórica de los indicadores de eficiencia energética del sector eléctrico en Colombia y se pueden generar diferentes escenarios a partir de los datos actuales del país, para evaluar estrategias de eficiencia energética.</p>
                </div>
              </div>
              <div class="row main-row">
                <div class="col-12 col-sm-6 col-xl-4 my-4 flex-grow-1">
                  <a href="#base-line" onclick="ActiveSection('base-line')">
                    <div class="card border-1 shadow card-effect">
                      <div class="card-body">
                        <div class="row d-block d-xl-flex align-items-center">
                          <div
                            class="col-12 col-xl-5 text-xl-center mb-3 mb-xl-0 d-flex align-items-center justify-content-xl-center">
                            <div class="icon-shape icon-shape-primary rounded me-4 me-sm-0 card-effect-icon">
                              <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                <path
                                  d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z">
                                </path>
                              </svg>
                            </div>
                            <div class="d-sm-none">
                              <h3 class="fw-extrabold mb-1">Línea base</h3>
                            </div>
                          </div>
                          <div class="col-12 col-xl-7 px-xl-0">
                            <div class="d-none d-sm-block">
                              <h3 class="fw-extrabold mb-2">Línea base</h3>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </a>
                </div>
                <div class="col-12 col-sm-6 col-xl-4 my-4 flex-grow-1">
                  {% if admin_session %}
                  <a href="#calculation" onclick="ActiveSection('calculation')">
                  {% else %}
                  <a href="#calculation" data-bs-toggle="modal" data-bs-target="#modal-calc">
                  {% endif %}
                    <div class="card border-1 shadow card-effect">
                      <div class="card-body position-relative">
                        {% if not admin_session %}
                        <img class="image comming-soon top-0 end-0" src="{{url_for('static',filename='images/proximamente.png')}}" height="84" width="104" alt="Próximamente logo.">
                        {% endif %}
                        <div class="row d-block d-xl-flex align-items-center">
                          <div class="col-12 col-xl-5 text-xl-center mb-3 mb-xl-0 d-flex align-items-center justify-content-xl-center">
                            <div class="icon-shape icon-shape-secondary rounded me-4 me-sm-0 card-effect-icon">
                              <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd"
                                  d="M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V4a2 2 0 00-2-2H6zm1 2a1 1 0 000 2h6a1 1 0 100-2H7zm6 7a1 1 0 011 1v3a1 1 0 11-2 0v-3a1 1 0 011-1zm-3 3a1 1 0 100 2h.01a1 1 0 100-2H10zm-4 1a1 1 0 011-1h.01a1 1 0 110 2H7a1 1 0 01-1-1zm1-4a1 1 0 100 2h.01a1 1 0 100-2H7zm2 1a1 1 0 011-1h.01a1 1 0 110 2H10a1 1 0 01-1-1zm4-4a1 1 0 100 2h.01a1 1 0 100-2H13zM9 9a1 1 0 011-1h.01a1 1 0 110 2H10a1 1 0 01-1-1zM7 8a1 1 0 000 2h.01a1 1 0 000-2H7z"
                                  clip-rule="evenodd"></path>
                              </svg>
                            </div>
                            <div class="d-sm-none">
                              <h3 class="fw-extrabold mb-1">Cálculo</h3>
                              <h2 class="h5">de indicadores de EE</h2>
                            </div>
                          </div>
                          <div class="col-12 col-xl-7 px-xl-0">
                            <div class="d-none d-sm-block">
                              <h3 class="fw-extrabold mb-2">Cálculo</h3>
                              <h2 class="h6 text-gray-400 mb-0">de indicadores de EE</h2>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </a>
                </div>
                {% set text_module = 'En el módulo de cálculo de indicadores se visualizará la tendencia histórica de los
                indicadores de eficiencia energética del sector eléctrico en Colombia y se pueden generar diferentes
                escenarios a partir de los datos actuales del país, para evaluar estrategias de
                eficiencia energética.'%}
                {{modals.render_modal('coming','calc','Cálculo de indicadores de EE', text_module)}}
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  
    <section id="base-line" hidden>
      <!-- section header -->
      <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center">
        <div class="d-block">
          <nav aria-label="breadcrumb" class="d-none d-md-inline-block">
            <ol class="breadcrumb breadcrumb-dark breadcrumb-transparent">
              <li class="breadcrumb-item">
                <a href="{{url_for('dashboard.main')}}">
                  <svg class="icon icon-xxs" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6">
                    </path>
                  </svg>
                </a>
              </li>
              <li class="breadcrumb-item"><a href="#" onclick="ActiveSection('main')">Cálculo  de indicadores</a></li>
              <li class="breadcrumb-item active" aria-current="page">Línea base</li>
            </ol>
          </nav>
        </div>
      </div>
      <div class="row mb-2 min-vh-85">
        <div class="col-12">
          <div class="card border-0 shadow h-100">
            <div class="card-body px-1 px-md-3 d-flex flex-column">
              <div class="row mb-2">
                <div class="col-12">
                  <span class="icon-shape icon-xs icon-shape-primary rounded me-4 me-sm-0 card-effect-icon">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                      <path
                        d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z">
                      </path>
                    </svg>
                  </span>
                  <span class="h2 fw-extrabold">Línea base</span>
                  <p class="m-1">Tándem de indicadores para la industria eléctrica.</p>
                </div>
              </div>
              <div class="row flex-fill px-1">
                <div class="card border-1 shadow mx-2 mx-md-0">
                  <div class="card-header p-0">
                    <div class="row justify-content-between m-0">
                      <!-- Dropdown menu-->
                      <div class="mx-0 my-1 col-xl-4 col-md-12 d-flex align-items-center justify-content-between flex-grow-1">
                        <div class="d-block mb-3 mb-sm-0 align-items-center">
                          <span class="sidebar-icon">
                            <svg class="icon-shape icon-xxs" fill="black" viewBox="0 0 720 720" xmlns="http://www.w3.org/2000/svg">
                              <path
                                d="M88 48C101.3 48 112 58.75 112 72V120C112 133.3 101.3 144 88 144H40C26.75 144 16 133.3 16 120V72C16 58.75 26.75 48 40 48H88zM480 64C497.7 64 512 78.33 512 96C512 113.7 497.7 128 480 128H192C174.3 128 160 113.7 160 96C160 78.33 174.3 64 192 64H480zM480 224C497.7 224 512 238.3 512 256C512 273.7 497.7 288 480 288H192C174.3 288 160 273.7 160 256C160 238.3 174.3 224 192 224H480zM480 384C497.7 384 512 398.3 512 416C512 433.7 497.7 448 480 448H192C174.3 448 160 433.7 160 416C160 398.3 174.3 384 192 384H480zM16 232C16 218.7 26.75 208 40 208H88C101.3 208 112 218.7 112 232V280C112 293.3 101.3 304 88 304H40C26.75 304 16 293.3 16 280V232zM88 368C101.3 368 112 378.7 112 392V440C112 453.3 101.3 464 88 464H40C26.75 464 16 453.3 16 440V392C16 378.7 26.75 368 40 368H88z" />
                            </svg>
                          </span>
                          <span class="fs-5 fw-extrabold mb-2">Indicadores de eficiencia energética</span>
                        </div>
                      </div>
                      <div class="mx-0 my-1 col-xl-4 col-md-12 d-flex align-items-center justify-content-between justify-content-xl-center">
                        <span class="h6 fw-bold p-1"><strong>Nivel de desagregación</strong> </span>
                        <div class="btn-group p-1">
                          <button id="select-dropdown" type="button"
                            class="btn btn-sm btn-sm btn-secondary dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false">
                            <span>Seleccionar</span>
                            <svg class="icon icon-xs" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                              <path fill-rule="evenodd"
                                d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                clip-rule="evenodd"></path>
                            </svg>
                          </button>
                          <div class="dropdown-menu">
                            <a class="dropdown-item" onclick="update_list_agregados('Agregados')" href="#">Agregados</a>
                            <a class="dropdown-item" onclick="update_list_desagregados('generation')" href="#">Desagregados</a>
                          </div>
                        </div>
                      </div>
                      <div class="mx-0 my-1 col-xl-4 col-md-12 d-flex align-items-center justify-content-between justify-content-xl-center">
                        <span class="h6 fw-bold p-1"><strong>Cadena de Valor</strong> </span>
                        <div class="btn-group p-1">
                          <button type="button" id="cadena_valor"
                            class="btn btn-sm btn-sm btn-secondary dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false">
                            <span>Seleccionar</span>
                            <svg class="icon icon-xs" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                              <path fill-rule="evenodd"
                                d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                clip-rule="evenodd"></path>
                            </svg>
                          </button>
                          <div class="dropdown-menu">
                            <a class="dropdown-item" onclick="update_list_ind('generation')">Generación</a>
                            <a class="dropdown-item" onclick="update_list_ind('distribution')">Distribución</a>
                            <a class="dropdown-item" onclick="update_list_ind('end_use')">Uso final</a>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="card-body px-1 px-md-3 py-1">
                    <div class="row mb-2 mt-2 m-0">
                      <div class="col-12 col-xl-4 mb-1 px-0 d-flex align-self-stretch flex-fill">
                        <div class="card border-0 flex-fill">
                          <div class="card-body align-self-stretch p-2">
                            <!-- Section Table -->
                            <div class="table-responsive info-table" id="table_content_1"></div>
                          </div>
                          <div class="small m-2 p-2 text-center">
                            <span class="d-block fs-3 fw-normal">Valor mas reciente</span>
                            <span class="fw-normal me-2">Promedio</span>
                            <span class="fas fa-angle-up text-success"></span>
                            <span class="text-success fw-bold">Variación último año</span>
                          </div>
                        </div>
                      </div>
                      <div class="col-12 col-xl-8 mb-1 px-0 d-flex align-self-stretch">
                        <div class="card border-0 flex-fill">
                          <div class="card-header p-1 d-sm-flex flex-row align-items-center">
                            <div class="card-body p-0">
                              <!-- Graph Section -->
                              <div class="row mb-2 mt-2 m-0">
                                <div class="col-12 col-xl-12 mb-1 px-0 d-flex align-self-stretch">
                                  <div class="card border-0 flex-fill">
                                    <div class="card-header d-sm-flex flex-row align-items-center flex-0">
                                      <div class="d-block mb-3 mb-sm-0">
                                        <span class="fs-5 fw-extrabold mb-2" id="chart_title_1">Indicador seleccionado</span>
                                      </div>
                                    </div>
                                    <div class="card-body p-1 flex-fill" id="graph-container_1">
                                      <canvas id="line-chart_1" width="100%" height="50%"></canvas>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  
    <section id="calculation" hidden>
      <!-- section header -->
      <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center">
        <div class="d-block">
          <nav aria-label="breadcrumb" class="d-none d-md-inline-block">
            <ol class="breadcrumb breadcrumb-dark breadcrumb-transparent">
              <li class="breadcrumb-item">
                <a href="{{url_for('dashboard.main')}}">
                  <svg class="icon icon-xxs" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6">
                    </path>
                  </svg>
                </a>
              </li>
              <li class="breadcrumb-item"><a href="#" onclick="ActiveSection('main')">Cálculo de indicadores</a></li>
              <li class="breadcrumb-item active" aria-current="page">Cálculo</li>
            </ol>
          </nav>
        </div>
      </div>
      <div class="row mb-2 min-vh-85">
        <div class="col-12">
          <div class="card border-0 shadow h-100">
            <div class="card-body px-1 px-md-3 d-flex flex-column">
              <div class="row mb-2 mb-lg-2">
                <div class="col-12 col-md-8">
                  <span class="h2 fw-extrabold">Variables</span>
                  <p class="m-1">Variables de proceso para la industria eléctrica.</p>
                </div>
                <div class="col-12 col-md-8">
                  <div class="btn-toolbar d-flex justify-content-end">
                    <a href="#" class="btn btn-sm btn-gray-800 d-inline-flex align-items-center">
                      <svg class="icon icon-xs me-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                      </svg>
                      Cargar información
                    </a>
                  </div>
                </div>
              </div>
              <div class="card border-1 shadow components-section flex-grow-1">
                <div class="row card-body justify-content-between m-0">
                  <!-- Dropdown menu-->
                  <div class="m-0 col-xxl-4 col-md-12 d-flex align-items-center justify-content-between">
                    <span class="h6 fw-bold mr-1"> <strong>Cadena de Valor</strong> </span>
                    <div class="btn-group me-2">
                      <button type="button" class="btn btn-sm btn-secondary dropdown-toggle dropdown-toggle-split"
                        data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <span class="sr-only">Seleccionar</span>
                        <svg class="icon icon-xs" fill="currentColor" viewBox="0 0 20 20"
                          xmlns="http://www.w3.org/2000/svg">
                          <path fill-rule="evenodd"
                            d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                            clip-rule="evenodd"></path>
                        </svg>
                      </button>
                      <div class="dropdown-menu">
                        <a class="dropdown-item" href="#">Generación</a>
                        <a class="dropdown-item" href="#">Distribución</a>
                        <a class="dropdown-item" href="#">Uso final</a>
                      </div>
                    </div>
                  </div>
                  <div class="m-1 col-xxl-2 col-md-12 d-flex align-items-center justify-content-between">
                    <span class="h6 fw-bold"> <strong>Tipo</strong> </span>
                    <div class="btn-group me-2">
                      <button type="button" class="btn btn-sm btn-secondary dropdown-toggle dropdown-toggle-split"
                        data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <span class="sr-only">Seleccionar</span>
                        <svg class="icon icon-xs" fill="currentColor" viewBox="0 0 20 20"
                          xmlns="http://www.w3.org/2000/svg">
                          <path fill-rule="evenodd"
                            d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                            clip-rule="evenodd"></path>
                        </svg>
                      </button>
                      <div class="dropdown-menu">
                        <a class="dropdown-item" href="#">Energéticos</a>
                        <a class="dropdown-item" href="#">Económico-Energéticos</a>
                        <a class="dropdown-item" href="#">Físico-Energéticos</a>
                        <a class="dropdown-item" href="#">Energético-Ambientales</a>
                      </div>
                    </div>
                  </div>
                  <div class="m-1 col-xxl-2 col-md-12 d-flex align-items-center justify-content-between">
                    <span class="h6 fw-bold"> <strong>Proceso</strong> </span>
                    <div class="btn-group me-2">
                      <button type="button" class="btn btn-sm btn-secondary dropdown-toggle dropdown-toggle-split"
                        data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <span class="sr-only">Seleccionar</span>
                        <svg class="icon icon-xs" fill="currentColor" viewBox="0 0 20 20"
                          xmlns="http://www.w3.org/2000/svg">
                          <path fill-rule="evenodd"
                            d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                            clip-rule="evenodd"></path>
                        </svg>
                      </button>
                      <div class="dropdown-menu">
                        <a class="dropdown-item" href="#">Entrada</a>
                        <a class="dropdown-item" href="#">Salida</a>
                      </div>
                    </div>
                  </div>
                  <div class="m-1 col-xxl-2 col-md-12 d-flex align-items-center justify-content-between">
                    <span class="h6 fw-bold"> <strong>FNCE</strong> </span>
                    <div class="btn-group me-2">
                      <button type="button" class="btn btn-sm btn-secondary dropdown-toggle dropdown-toggle-split"
                        data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <span class="sr-only">Seleccionar</span>
                        <svg class="icon icon-xs" fill="currentColor" viewBox="0 0 20 20"
                          xmlns="http://www.w3.org/2000/svg">
                          <path fill-rule="evenodd"
                            d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                            clip-rule="evenodd"></path>
                        </svg>
                      </button>
                      <div class="dropdown-menu">
                        <a class="dropdown-item" href="#">Con relación</a>
                        <a class="dropdown-item" href="#">Sin relación</a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
  
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Graph Section -->
<!--   <div class="row">
    <div class="col-12 mb-4">
      <div class="card bg-yellow-100 border-0 shadow">
        <div class="card-header d-sm-flex flex-row align-items-center flex-0">
          <div class="d-block mb-3 mb-sm-0">
            <div class="fs-5 fw-normal mb-2">Sales Value</div>
            <h2 class="fs-3 fw-extrabold">$10,567</h2>
            <div class="small mt-2">
              <span class="fw-normal me-2">Yesterday</span>
              <span class="fas fa-angle-up text-success"></span>
              <span class="text-success fw-bold">10.57%</span>
            </div>
          </div>
          <div class="d-flex ms-auto">
            <a href="#" class="btn btn-secondary text-dark btn-sm me-2">Month</a>
            <a href="#" class="btn btn-dark btn-sm me-3">Week</a>
          </div>
        </div>
        <div class="card-body p-2">
          <div class="ct-chart-sales-value ct-double-octave ct-series-g"></div>
        </div>
      </div>
    </div>
  </div> -->
  <!-- Configuration buttons for the number of table rows -->
  <!-- Extra Buttons -->
  <div class="row d-flex flex-row justify-content-between">
    <div class="col-2 col-md-2 btn-group mt-4 ms-2 ms-lg-3">
      <button type="button" class="btn btn-sm btn-outline-gray-600">Compartir</button>
      <button type="button" class="btn btn-sm btn-outline-gray-600">Exportar</button>
    </div>
  </div>
    </section>

    {% block footer %}
    {% include 'module/footer.html' %}
    {% endblock %}
  </main>
</body>
{% endblock %}

{% block scripts%}
{{super()}}
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/simple-datatables@latest" crossorigin="anonymous"></script>
<script charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/datatables.net-colreorder/1.5.6/dataTables.colReorder.min.js" integrity="sha512-BA+XWPyIsXxbBMmGU7Acq8vBGWAFldhFLOkoU4dL+B6Fs16RnhCC9ff+vy5GzmB783tyuzYs42QGHRbV73e1ug==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<!--<script type="text/javascript">
  var el = document.getElementById('accordionIndicadores');
    el.innerHTML= '<div class="mt-3 accordion accordion-flush col-xl-3 col-md-12">'+
                    '<div class="accordion-item">'+
                      '<h2 class="accordion-header" id="headingOne">'+
                        '<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne"'+
                          'aria-expanded="false" aria-controls="collapseOne">'+
                          'Participacion den la generación electrica'+
                        '</button>'+
                      '</h2>'+
                      '<div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne"'+
                        'data-bs-parent="#accordionPricing">'+
                        '<div class="accordion-body">'+
                          '<div class="form-check">'+
                            '<input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1">'+
                            '<label class="form-check-label" for="flexRadioDefault1">'+
                              'Participacion de fuentes fosiles xxxxxxxxxxxxx'+
                            '</label>'+
                          '</div>'+
                          '<div class="form-check">'+
                            '<input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault2" checked>'+
                            '<label class="form-check-label" for="flexRadioDefault2">'+
                              'Participacion de fuentes hidricas'+
                            '</label>'+
                          '</div>'+

                          '<div class="form-check">'+
                            '<input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1">'+
                            '<label class="form-check-label" for="flexRadioDefault1">'+
                             'Participacion de FNC matriz energetica'+
                            '</label>'+
                          '</div>'+

                          '<div class="form-check">'+
                            '<input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1">'+
                            '<label class="form-check-label" for="flexRadioDefault1">'+
                              'Participacion de fuentes solares'+
                            '</label>'+
                          '</div>'+

                        '</div>'+
                      '</div>'+
                    '</div>'+
                  '</div>';
</script>-->
<script type="text/javascript">
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']]
    }
  };
  </script>

<!-- Variables Datatable.js handler -->
<!-- Callback for combobox on variable view :) -->
<script type="text/javascript">
  var _table_ = document.createElement('table'),
      _tr_ = document.createElement('tr'),
      _th_ = document.createElement('th'),
      _td_ = document.createElement('td'),
      _thead_ = document.createElement('thead'),
      _tbody_ = document.createElement('tbody'),
      _i_ = document.createElement('i'),
      _a_ = document.createElement('a');
      var last_indicator = '';
      var limite_graficas = false;

  function update_list_ind(list_name){
    SetSelectName('cadena_valor', list_name);

    document.getElementById("cadena_valor").disabled = false;

    var json_file = JSON.parse('{{data_indicators | tojson | safe}}');
    var keys_list = Object.keys(json_file[list_name])
    var keys_list_2 = []
    var keys_list_3 = []
    var json_table = {}
    var json_aux_ind
    var json_aux_des
    var json_desagregacion = []
    var json_desagregacion_completo = []

    keys_list.forEach(function (item, index) {
      var name = item;
      if (item === 'Desagregacion'){
        json_aux_des = json_file[list_name][item];
      }else {
        json_aux_ind = json_file[list_name][item];
      }
    });

    keys_list_2 = Object.keys(json_aux_ind)

      keys_list_2.forEach(function (item2, index) {
        keys_list_3 = Object.keys(json_aux_des)
          keys_list_3.forEach(function (item3, index) {
            if((json_aux_ind[item2]['INDICADOR_ID'])===(json_aux_des[item3]['REL_VARIABLES_DESAGREGACION'])){
              json_desagregacion.push(json_aux_des[item3]['DESAGREGACION_NOMBRE'])
              json_desagregacion_completo.push(json_desagregacion)
              json_desagregacion = []
            }
          });
        var indicador_nombre = json_aux_ind[item2]['INDICADOR_AGREGADO']
        json_table[indicador_nombre] = json_desagregacion_completo;
        json_desagregacion_completo = []
      });
      loadTable_variables_ind(list_name, json_table);
    }

    function update_list_desagregados(list_name) {
      SetSelectName('select-dropdown', 'desagregados');
      update_list_ind(list_name);
    }
    function update_list_agregados(list_name){
      
      SetSelectName('select-dropdown', list_name);

      document.getElementById("cadena_valor").disabled = true;
      var json_file = JSON.parse('{{data_total_indicators | tojson | safe}}');
      var keys_list_2 = []
      var json_table = {}
      limite_graficas = true;

      var keys_list = Object.keys(json_file)

      keys_list.forEach(function (item, index) {
        var json_aux = json_file[item];
        keys_list_2 = Object.keys(json_aux);
        json_table[item] = keys_list_2;
      });
      loadTable_variables_ind(list_name, json_table);
    }

  /*
  funcion que devuelve una vista de los datos en forma de una acordeon desplegable
  se deja por si en algun momento se tiene que volver a usar
   */

  /*function loadTable_variables_ind_new(list_name, json_new){

  var list_names = Object.keys(json_new)

  console.log("loadTable_variables_ind_new");
  console.log("list_names");
  console.log(list_names);

  var el = document.getElementById('accordionIndicadores');
  let check = "";
  el.innerHTML = '';
  list_names.forEach(function(items,index){
    var tamanio = index;
    check         +=' <div class="mt-3 accordion accordion-flush col-xl-6 col-md-6">'
                  +'    <div class="accordion-item">'
                  +'        <h2 class="accordion-header" id="headingOne'+tamanio+'">'
                  +'            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne'+tamanio+'"'
                  +'              aria-expanded="false" aria-controls="collapseOne'+tamanio+'">'
                  +               items
                  +'            </button>'
                  +'         </h2>'
                  +'       <div id="collapseOne'+tamanio+'" class="accordion-collapse collapse" aria-labelledby="headingOne'+tamanio+'"'
                  +'        data-bs-parent="#accordionPricing">'
                  +'          <div class="accordion-body">';

                  var keys_list = json_new[items];
                  //var translate_array = JSON.parse('{{translating_dict | tojson | safe}}');
                  keys_list.forEach(function (item, index) {
                  var keys_list_tam = index;
                  check     +='  <div class="form-check">'
                                +'      <input class="form-check-input" onclick="create_chart_indic(\''+list_name+'\',\''+items+'\',\''+item+'\')" href="#" type="radio" name="flexRadioDefault" id="flexRadioDefault'+keys_list_tam+'">'
                                +'        <label class="form-check-label" for="flexRadioDefault'+keys_list_tam+'">'
                                +           item
                                +'        </label>'
                                +'   </div>';
                  });

          check  +='         </div>'
                  +'        </div>'
                  +'    </div>'
                  +'  </div>';
    });
    
    el.innerHTML += check;

    

      console.log("list_name");
      console.log(list_name);
      
      console.log("child");
      //console.log(child);

      console.log("row");
     //console.log(row);
      //create_chart_indic(list_name, child, row);
}*/


  function loadTable_variables_ind(list_name, json_new){

    var list_names = Object.keys(json_new)
    var table = _table_.cloneNode(false);
    var tbody = _tbody_.cloneNode(false),

    columns = addAllColumnHeaders(list_name);
    list_names.forEach(function(items,index){

      var tr = _tr_.cloneNode(false);
      var td = _td_.cloneNode(false);
      var a = _a_.cloneNode(false);
      a.appendChild(document.createTextNode(items || ''));
      td.classList.add('fw-extrabold')
      td.classList.add('showhr')
      var i = _i_.cloneNode(false);
      i.classList.add('fa-solid')
      //i.classList.add('fa-angle-right') 
      i.classList.add('fa-caret-down')
      i.classList.add('pe-1')

      td.appendChild(i);
      td.appendChild(a);
      tr.appendChild(td);  
      tbody.appendChild(tr);
      var keys_list = json_new[items];

      var translate_array = JSON.parse('{{translating_dict | tojson | safe}}');
      keys_list.forEach(function (item, index) {

        var tr = _tr_.cloneNode(false);
        var td = _td_.cloneNode(false);
        var cell_value;
        if(item in translate_array){
          cell_value = translate_array[item];
        } else{
          cell_value = item;
        }
        td.appendChild(document.createTextNode(cell_value|| ''));
        td.classList.add('aser')
        td.classList.add('fw-normal')
        tr.appendChild(td);
        tr.style.display = 'none';
        tbody.appendChild(tr);
      })
    })

    table.appendChild(tbody);

    table.id = 'table_variables'
    table.classList.add('table');
    table.classList.add('table-centered');
    table.classList.add('table-nowrap');
    table.classList.add('rounded');
    table.classList.add('mb-0');
    table.classList.add('border-0');
    table.classList.add('dt-responsive');

    function addAllColumnHeaders(list_name) {
      var columnSet = [],
      thead = _thead_.cloneNode(false);
      tr = _tr_.cloneNode(false);
      var th = _th_.cloneNode(false);
      if (list_name === 'generation'){
        var key = 'Generación';
      } else if (list_name === 'distribution'){
        var key = 'Distribución';
      } else if (list_name === 'end_use'){
        var key = 'Uso final';
      } else if (list_name === 'Agregados'){
        var key = 'Agregados';
      }
      columnSet.push(key)
      th.appendChild(document.createTextNode(key));
      th.classList.add('rounded');
      th.classList.add('border-0');
      tr.appendChild(th);
      thead.appendChild(tr);
      thead.classList.add('thead-light');
      table.appendChild(thead);
      return columnSet;
    }

    var el = document.getElementById('table_content_1');
    el.innerHTML= '';
    el.appendChild(table);
    const datatablesSimple = document.getElementById('table_variables');
    if (datatablesSimple) {
      let tables = new DataTable(datatablesSimple, {
      language: {
        url: '//cdn.datatables.net/plug-ins/1.11.5/i18n/es-ES.json'
      },
      ordering: false,
      hover: true,
      filter: false,
      responsive:true,
      pageLength: 200,
      scrollResize: true,
      scrollX: false,
      scrollY: 300,
      scrollCollapse:false,
      dom: 'Bfrtip',
      aaSorting: [],
      info:false,
      deferRender: true,
      paging: false,
      buttons: [
            'copyHtml5',
            'excelHtml5',
            'csvHtml5',
            'pdfHtml5'
        ]
      });
    }

    var table_handler = $('#table_variables').DataTable();
    if (contador == 0){
      // fue necesario agregar el contador para que la primera interaccion con math funcione sin promesas, porque daba error.
        contador = contador+1;
        $('#table_variables tbody').on('click', 'tr', function () {
          var td_select = this.childNodes[0]
          if(td_select.classList.contains("showhr")){
            $(this).closest('tr').nextUntil("tr:has(.showhr)").toggle("slow", function() {});
          }
          else if(td_select.classList.contains('aser')) {
            var child = $(this).prevAll('tr:has(.showhr)')[0].innerText;
            var data = table_handler.row(this).data();
            var translate_array = JSON.parse('{{translating_dict | tojson | safe}}');
            var row = [Object.keys(translate_array).find(key => translate_array[key] == data)];
            if (row[0] == null){
              row = data;
            }
            create_chart_indic(list_name, child, row);
          }
        }
        );
    }else{
      MathJax.typesetPromise().then(() => {
      $('#table_variables tbody').on('click', 'tr', function () {
          var td_select = this.childNodes[0]
          if(td_select.classList.contains("showhr")){
            $(this).closest('tr').nextUntil("tr:has(.showhr)").toggle("slow", function() {});
          }
          else if(td_select.classList.contains('aser')) {
            var child = $(this).prevAll('tr:has(.showhr)')[0].innerText;
            var data = table_handler.row(this).data();
            var translate_array = JSON.parse('{{translating_dict | tojson | safe}}');
            var row = [Object.keys(translate_array).find(key => translate_array[key] == data)];
            if (row[0] == null){
              row = data;
            }
            create_chart_indic(list_name, child, row);
          }
        }
        );
        MathJax.typesetPromise(); }).catch((err) => console.log(err.message));
    }
  }

  function create_chart_indic(list_name, indicator2, key){
    var row1 = key[0];    
    var row2 = row1.replace("$CO_2eq$","CO2eq");
    var row = row2.replace(/ /gi,"_");
    //hubo necesidad de quitar los saltos de linea que se crean cuando se hace el replace para matjax
    var indicador3 = indicator2.replace(/\n/gi,"");
    indicator = indicador3

    var al= Math.floor((Math.random()* (255)));
    var al2= Math.floor((Math.random()* (255)));

    var b_colorslist = ['rgba('+al+', '+al2+', 132, 0.2)', 'rgba('+al+', '+al2+', 235, 0.2)', 'rgba('+al+', '+al2+', 86, 0.2)', 'rgba('+al+', '+al2+', 192, 0.2)', 'rgba('+al+', '+al2+', 255, 0.2)', 'rgba('+al+', '+al2+', 64, 0.2)'];
    var colorslist = ['rgba('+al+', '+al2+', 132, 1)', 'rgba('+al+', '+al2+', 235, 1)', 'rgba('+al+', '+al2+', 86, 1)', 'rgba('+al+', '+al2+', 192, 1)', 'rgba('+al+', '+al2+', 255, 1)', 'rgba('+al+', '+al2+', 64, 1)'];
    /* const table_name = key; */
    const table_name = indicator;
    document.getElementById('chart_title_1').innerHTML = table_name;
    if (list_name == "Agregados"){
      var json_file = JSON.parse('{{data_total_indicators | tojson | safe}}');
      var table = json_file[indicator][row1];
    }else{
      var json_file = JSON.parse('{{data_indicators | tojson | safe}}');
      var table = json_file[list_name]['Data'];
    }
    var keys = Object.keys(table[0]);
    var labels = table.map(function(e) {
      return e[keys[0]];
    });

    if (list_name == "Agregados"){
      var data = table.map(function(e) {
        return e[row2];
      });;
    }else {
      var data = table.map(function(e) {
        return e[row];
      });;
    }

    length = data.length;
    var array=[];
    for (var j = 0; j < length; j++){
      array.push(parseFloat(data[j]));
    }
    var unit = '';
    var units = JSON.parse('{{units | tojson | safe}}');

    if (list_name == "Agregados"){
      if (row1 in units){
        unit = units[row1];
        /*if (unit=='Porcentaje %'){
          array = array.map(function(x) { return x * 100; });;
        }*/
      }
    }else {
      if (indicator in units){
        unit = units[indicator];
        /*if (unit=='Porcentaje %'){
          array = array.map(function(x) { return x * 100; });;
        }*/
      }
    }

    if ((last_indicator==indicator || (list_name == "Agregados" && last_indicator != "") ) && !limite_graficas){
      if (!(keys_list.includes(row2))){
        keys_list.push(row2);
        var update_dataset = {}
          if (list_name == "Agregados"){
            update_dataset = {
            label: row2,  
            borderColor: colorslist[keys_list.length], 
            backgroundColor: b_colorslist[keys_list.length], 
            data: array,
            spanGraphs: false, 
            fill: true,
            yAxisID: 'y1'
            };

            chart_element.options.scales.yAxes.push(
              {
                stacked: false,
                scaleLabel: {
                  display: true,
                  labelString: unit
                },
                id: "y1",
                position: "right"
              })
              limite_graficas = true;
          }else{
              update_dataset = {
              label: row2,
              borderColor: colorslist[keys_list.length],
              backgroundColor: b_colorslist[keys_list.length],
              data: array,
              spanGraphs: false,
              fill: true
              };
          }
        chart_element.data.datasets.push(update_dataset);
        chart_element.update();
      } else {
        keys_list = keys_list.filter(data => data != row2);;
        chart_element.data.datasets=  chart_element.data.datasets.filter(data => data.label != row2);
        chart_element.update();
      }
      
    } else {
    keys_list=[row2]
    var mydatasets = [{
      label: row2,  
      borderColor: colorslist[0], 
      backgroundColor: b_colorslist[0], 
      data: array, 
      spanGraphs: false,
      fill: true,
      yAxisID: 'y'
    }];


    let delayed;
    $('#line-chart_1').remove(); 
    $('#graph-container_1').append('<canvas id="line-chart_1" width="100%" height="50%"><canvas>'); 
    var config = {
        type: 'line',
        data: {
          labels: labels,
          datasets: mydatasets
        },
        options: {
          responsive: true,
          scales: {
            xAxes: [{
              stacked: true,
              scaleLabel: {
                display: true,
                labelString: 'Año'
              }
            }],
            yAxes: [{
              stacked: false,
              scaleLabel: {
                display: true,
                labelString: unit
              },
              id: "y"
            }]
          },
          title: {
            display: false,
            text: table_name,
          },
          legend: {
            position: 'bottom',
          },
          animation: {
            onComplete: () => {
              delayed = true;
            },
            delay: (context) => {
              let delay = 0;
              if (context.type === 'data' && context.mode === 'default' && !delayed) {
                delay = context.dataIndex * 300 + context.datasetIndex * 100;
              }
              return delay;
            },
            }}
      };
    chart_element = new Chart(document.getElementById('line-chart_1'), config);
    limite_graficas = false;
    }
    last_indicator = indicator;
  }
</script>

<script type="text/javascript">
      var list_name = 'generation';
      var key = 'Factor de Pérdidas';
      var contador = 0;
      update_list_ind(list_name);     
      /* create_chart(list_name, key); */
</script>

{% endblock %}
